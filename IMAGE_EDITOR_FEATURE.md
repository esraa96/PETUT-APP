# ميزة تحرير الصور - Image Editor Feature

## نظرة عامة
تم إضافة ميزة تحرير الصور التي تسمح للمستخدمين بتحرير الصور بعد رفعها مباشرة. تتضمن الميزة إمكانيات الزوم والكروب (القص) للصور.

## المكونات المضافة

### 1. ImageEditor.jsx
مكون أساسي لتحرير الصور يوفر:
- **الزوم**: تكبير وتصغير الصورة (0.5x إلى 3x)
- **الكروب**: قص الصورة حسب المنطقة المحددة
- **السحب**: تحريك الصورة داخل منطقة التحرير
- **واجهة سهلة الاستخدام**: أزرار واضحة وشريط تمرير للزوم

### 2. ImageUploadWithEditor.jsx
مكون شامل لرفع الصور مع إمكانية التحرير يوفر:
- **رفع الصور**: واجهة سهلة لرفع الصور
- **معاينة الصور**: عرض الصورة المرفوعة
- **تحرير الصور**: إمكانية تحرير الصورة المرفوعة
- **حذف الصور**: إمكانية حذف الصورة
- **التحقق من الملفات**: فحص نوع وحجم الملف

## الاستخدام

### استخدام ImageUploadWithEditor
```jsx
import ImageUploadWithEditor from '../components/common/ImageUploadWithEditor';

const MyComponent = () => {
  const [image, setImage] = useState(null);

  const handleImageChange = (imageData) => {
    setImage(imageData);
  };

  return (
    <ImageUploadWithEditor
      onImageChange={handleImageChange}
      currentImage={image}
      label="صورة (اختيارية)"
    />
  );
};
```

### استخدام ImageEditor مباشرة
```jsx
import ImageEditor from '../components/common/ImageEditor';

const MyComponent = () => {
  const [showEditor, setShowEditor] = useState(false);
  const [imageData, setImageData] = useState(null);

  const handleSave = (editedImage) => {
    // حفظ الصورة المحررة
    setImageData(editedImage);
    setShowEditor(false);
  };

  const handleCancel = () => {
    setShowEditor(false);
  };

  return (
    <>
      {showEditor && (
        <ImageEditor
          imageData={imageData}
          onSave={handleSave}
          onCancel={handleCancel}
        />
      )}
    </>
  );
};
```

## الصفحات المحدثة

### 1. CreatePostScreen.jsx
- تم استبدال رفع الصور التقليدي بـ ImageUploadWithEditor
- يظهر محرر الصور تلقائياً بعد اختيار الصورة
- إمكانية تحرير الصورة مرة أخرى بعد الحفظ

### 2. EditPostScreen.jsx
- تم استبدال رفع الصور التقليدي بـ ImageUploadWithEditor
- يظهر محرر الصور عند تعديل صورة البوست
- إمكانية تحرير الصورة الحالية أو رفع صورة جديدة

### 3. ChatScreen.jsx
- تم إضافة محرر الصور عند إرسال الصور في الرسائل
- يظهر المحرر تلقائياً بعد اختيار الصورة
- التحقق من حجم ونوع الصورة قبل التحرير

### 4. ProfileImageManager.jsx
- تم إضافة محرر الصور لصور الملف الشخصي
- يظهر المحرر عند رفع صورة جديدة للملف الشخصي
- يحافظ على جودة الصورة بعد التحرير

## الميزات التقنية

### إدارة الصور
- **تحويل Base64**: تحويل الصور إلى Base64 للمعالجة
- **Canvas API**: استخدام Canvas لرسم ومعالجة الصور
- **ضغط الصور**: حفظ الصور بجودة 80% لتوفير المساحة
- **التحقق من الملفات**: فحص نوع وحجم الملف قبل المعالجة

### واجهة المستخدم
- **تصميم متجاوب**: يعمل على جميع أحجام الشاشات
- **الوضع المظلم**: دعم كامل للوضع المظلم
- **رسائل واضحة**: رسائل خطأ ونجاح باللغة العربية
- **تفاعل سلس**: انتقالات وتأثيرات بصرية ناعمة

## قيود النظام
- **حجم الملف**: حد أقصى 5 ميجابايت للصورة الواحدة
- **أنواع الملفات**: PNG, JPG, JPEG فقط
- **دقة الكروب**: 300x200 بكسل للصورة النهائية
- **مستوى الزوم**: من 0.5x إلى 3x

## كيفية استخدام Free Crop

1. **تفعيل وضع القص**: اضغط على زر القص (المقص) لتفعيل وضع Free Crop
2. **تحريك منطقة القص**: اضغط داخل المنطقة المحددة واسحبها إلى المكان المطلوب
3. **تغيير حجم منطقة القص**: اسحب أي من الزوايا الأربع لتغيير الحجم
4. **تحريك الصورة**: أوقف وضع القص واسحب الصورة لتحريكها
5. **الزوم**: استخدم شريط التمرير أو الأزرار للتكبير والتصغير
6. **الحفظ**: اضغط حفظ للحصول على الصورة المقصوصة بالحجم المحدد

## التحسينات المستقبلية
- إضافة فلاتر للصور
- إمكانية تدوير الصور
- حفظ متعدد الأحجام
- معاينة مباشرة للتغييرات
- تراجع عن التغييرات (Undo/Redo)

## استكشاف الأخطاء

### مشاكل شائعة
1. **الصورة لا تظهر**: تأكد من أن البيانات بصيغة Base64 صحيحة
2. **المحرر لا يفتح**: تحقق من أن `showEditor` و `tempImage` محددان بشكل صحيح
3. **الكروب لا يعمل**: تأكد من أن Canvas مدعوم في المتصفح

### حلول
- استخدم `console.log` لفحص البيانات
- تأكد من تحديث المتصفح
- فحص وحدة التحكم للأخطاء JavaScript